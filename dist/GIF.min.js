+function(){function e(e){var r=0;if(71!==e[r++]||73!==e[r++]||70!==e[r++]||56!==e[r++]||57!==e[r++]||97!==e[r++])throw"Invalid GIF 89a header.";{var n=e[r++]|e[r++]<<8,o=e[r++]|e[r++]<<8,i=e[r++],a=i>>7,f=7&i,u=1<<f+1;e[r++]}e[r++];var c=null;a&&(c=r,r+=3*u);var s=null,l=!0,d=[],h=0,w=null,v=0,s=null;for(this.width=n,this.height=o;l&&r<e.length;)switch(e[r++]){case 33:switch(e[r++]){case 255:if(11!==e[r]||78==e[r+1]&&69==e[r+2]&&84==e[r+3]&&83==e[r+4]&&67==e[r+5]&&65==e[r+6]&&80==e[r+7]&&69==e[r+8]&&50==e[r+9]&&46==e[r+10]&&48==e[r+11]&&3==e[r+12]&&1==e[r+13]&&0==e[r+16])r+=14,s=e[r++]|e[r++]<<8,r++;
else for(r+=12;;){var y=e[r++];if(0===y)break;r+=y}break;case 249:if(4!==e[r++]||0!==e[r+4])throw"Invalid graphics extension block.";var p=e[r++];h=e[r++]|e[r++]<<8,w=e[r++],0===(1&p)&&(w=null),v=p>>2&7,r++;break;case 254:for(;;){var y=e[r++];if(0===y)break;r+=y}break;default:throw"Unknown graphic control label: 0x"+e[r-1].toString(16)}break;case 44:var g=e[r++]|e[r++]<<8,B=e[r++]|e[r++]<<8,m=e[r++]|e[r++]<<8,x=e[r++]|e[r++]<<8,b=e[r++],F=b>>7,I=b>>6&1,E=7&b,k=1<<E+1,G=c,A=!1;if(F){var A=!0;G=r,r+=3*k
}var _=r;for(r++;;){var y=e[r++];if(0===y)break;r+=y}d.push({x:g,y:B,width:m,height:x,has_local_palette:A,palette_offset:G,data_offset:_,data_length:r-_,transparent_index:w,interlaced:!!I,delay:h,disposal:v});break;case 59:l=!1;break;default:throw"Unknown gif block: 0x"+e[r-1].toString(16)}this.numFrames=function(){return d.length},this.frameInfo=function(e){if(0>e||e>=d.length)throw"Frame index out of range.";return d[e]},this.decodeAndBlitFrameBGRA=function(r,o){var i=this.frameInfo(r),a=i.width*i.height,f=new Uint8Array(a);
t(e,i.data_offset,f,a);var u=i.palette_offset,c=i.transparent_index;null===c&&(c=256);var s=i.width,l=n-s,d=s,h=4*(i.y*n+i.x),w=4*((i.y+i.height)*n+i.x),v=h,y=4*l;i.interlaced===!0&&(y+=4*(s+l)*7);for(var p=8,g=0,B=f.length;B>g;++g){var m=f[g];if(0===d&&(v+=y,d=s,v>=w&&(y=l+4*(s+l)*(p-1),v=h+(s+l)*(p<<1),p>>=1)),m===c)v+=4;else{var x=e[u+3*m],b=e[u+3*m+1],F=e[u+3*m+2];o[v++]=F,o[v++]=b,o[v++]=x,o[v++]=255}--d}},this.decodeAndBlitFrameRGBA=function(r,o){var i=this.frameInfo(r),a=i.width*i.height,f=new Uint8Array(a);
t(e,i.data_offset,f,a);var u=i.palette_offset,c=i.transparent_index;null===c&&(c=256);var s=i.width,l=n-s,d=s,h=4*(i.y*n+i.x),w=4*((i.y+i.height)*n+i.x),v=h,y=4*l;i.interlaced===!0&&(y+=4*(s+l)*7);for(var p=8,g=0,B=f.length;B>g;++g){var m=f[g];if(0===d&&(v+=y,d=s,v>=w&&(y=l+4*(s+l)*(p-1),v=h+(s+l)*(p<<1),p>>=1)),m===c)v+=4;else{var x=e[u+3*m],b=e[u+3*m+1],F=e[u+3*m+2];o[v++]=x,o[v++]=b,o[v++]=F,o[v++]=255}--d}}}function t(e,t,r,n){for(var o=e[t++],i=1<<o,a=i+1,f=a+1,u=o+1,c=(1<<u)-1,s=0,l=0,d=0,h=e[t++],w=new Int32Array(4096),v=null;;){for(;16>s&&0!==h;)l|=e[t++]<<s,s+=8,1===h?h=e[t++]:--h;
if(u>s)break;var y=l&c;if(l>>=u,s-=u,y!==i){if(y===a)break;for(var p=f>y?y:v,g=0,B=p;B>i;)B=w[B]>>8,++g;var m=B,x=d+g+(p!==y?1:0);if(x>n)return void console.log("Warning, gif stream longer than expected.");r[d++]=m,d+=g;var b=d;for(p!==y&&(r[d++]=m),B=p;g--;)B=w[B],r[--b]=255&B,B>>=8;null!==v&&4096>f&&(w[f++]=v<<8|m,f>=c+1&&12>u&&(++u,c=c<<1|1)),v=y}else f=a+1,u=o+1,c=(1<<u)-1,v=null}return d!==n&&console.log("Warning, gif stream shorter than expected."),r}var r;"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.GifReader=e),LZWEncoder=function(){var e,t,r,n,o,i,a,f,u,c,s,l,d={},h=-1,w=12,v=5003,y=w,p=1<<w,g=[],B=[],m=v,x=0,b=!1,F=0,I=0,E=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],k=[],G=d.LZWEncoder=function(o,i,a,f){e=o,t=i,r=a,n=Math.max(2,f)
},A=function(e,t){k[l++]=e,l>=254&&Q(t)},_=function(e){W(m),x=c+2,b=!0,Z(c,e)},W=function(e){for(var t=0;e>t;++t)g[t]=-1},N=d.compress=function(e,t){var r,n,o,i,d,w,v;for(u=e,b=!1,a=u,f=U(a),c=1<<e-1,s=c+1,x=c+2,l=0,i=L(),v=0,r=m;65536>r;r*=2)++v;v=8-v,w=m,W(w),Z(c,t);e:for(;(o=L())!=h;)if(r=(o<<y)+i,n=o<<v^i,g[n]!=r){if(g[n]>=0){d=w-n,0===n&&(d=1);do if((n-=d)<0&&(n+=w),g[n]==r){i=B[n];continue e}while(g[n]>=0)}Z(i,t),i=o,p>x?(B[n]=x++,g[n]=r):_(t)}else i=B[n];Z(i,t),Z(s,t)},Q=(d.encode=function(r){r.writeByte(n),o=e*t,i=0,N(n+1,r),r.writeByte(0)
},function(e){l>0&&(e.writeByte(l),e.writeBytes(k,0,l),l=0)}),U=function(e){return(1<<e)-1},L=function(){if(0===o)return h;--o;var e=r[i++];return 255&e},Z=function(e,t){for(F&=E[I],I>0?F|=e<<I:F=e,I+=a;I>=8;)A(255&F,t),F>>=8,I-=8;if((x>f||b)&&(b?(f=U(a=u),b=!1):(++a,f=a==y?p:U(a))),e==s){for(;I>0;)A(255&F,t),F>>=8,I-=8;Q(t)}};return G.apply(this,arguments),d},"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=LZWEncoder),exports.LZWEncoder=LZWEncoder),NeuQuant=function(){var e,t,r,n,o,i={},a=256,f=499,u=491,c=487,s=503,l=3*s,d=a-1,h=4,w=100,v=16,y=1<<v,p=10,g=10,B=y>>g,m=y<<p-g,x=a>>3,b=6,F=1<<b,I=x*F,E=30,k=10,G=1<<k,A=8,_=1<<A,W=k+A,N=1<<W,Q=[],U=[],L=[],Z=[],T=i.NeuQuant=function(e,i,f){var u,c;
for(t=e,r=i,n=f,o=new Array(a),u=0;a>u;u++)o[u]=new Array(4),c=o[u],c[0]=c[1]=c[2]=(u<<h+8)/a,L[u]=y/a,U[u]=0},C=function(){for(var e=[],t=new Array(a),r=0;a>r;r++)t[o[r][3]]=r;for(var n=0,i=0;a>i;i++){var f=t[i];e[n++]=o[f][0],e[n++]=o[f][1],e[n++]=o[f][2]}return e},D=function(){var e,t,r,n,i,f,u,c;for(u=0,c=0,e=0;a>e;e++){for(i=o[e],r=e,n=i[1],t=e+1;a>t;t++)f=o[t],f[1]<n&&(r=t,n=f[1]);if(f=o[r],e!=r&&(t=f[0],f[0]=i[0],i[0]=t,t=f[1],f[1]=i[1],i[1]=t,t=f[2],f[2]=i[2],i[2]=t,t=f[3],f[3]=i[3],i[3]=t),n!=u){for(Q[u]=c+e>>1,t=u+1;n>t;t++)Q[t]=e;
u=n,c=e}}for(Q[u]=c+d>>1,t=u+1;256>t;t++)Q[t]=d},R=function(){var o,i,a,d,v,y,p,g,B,m,x,F,k,A;for(l>r&&(n=1),e=30+(n-1)/3,F=t,k=0,A=r,x=r/(3*n),m=x/w|0,g=G,y=I,p=y>>b,1>=p&&(p=0),o=0;p>o;o++)Z[o]=g*((p*p-o*o)*_/(p*p));for(B=l>r?3:r%f!==0?3*f:r%u!==0?3*u:r%c!==0?3*c:3*s,o=0;x>o;)if(a=(255&F[k+0])<<h,d=(255&F[k+1])<<h,v=(255&F[k+2])<<h,i=j(a,d,v),P(g,i,a,d,v),0!==p&&M(p,i,a,d,v),k+=B,k>=A&&(k-=r),o++,0===m&&(m=1),o%m===0)for(g-=g/e,y-=y/E,p=y>>b,1>=p&&(p=0),i=0;p>i;i++)Z[i]=g*((p*p-i*i)*_/(p*p))},S=(i.map=function(e,t,r){var n,i,f,u,c,s,l;
for(c=1e3,l=-1,n=Q[t],i=n-1;a>n||i>=0;)a>n&&(s=o[n],f=s[1]-t,f>=c?n=a:(n++,0>f&&(f=-f),u=s[0]-e,0>u&&(u=-u),f+=u,c>f&&(u=s[2]-r,0>u&&(u=-u),f+=u,c>f&&(c=f,l=s[3])))),i>=0&&(s=o[i],f=t-s[1],f>=c?i=-1:(i--,0>f&&(f=-f),u=s[0]-e,0>u&&(u=-u),f+=u,c>f&&(u=s[2]-r,0>u&&(u=-u),f+=u,c>f&&(c=f,l=s[3]))));return l},i.process=function(){return R(),S(),D(),C()},function(){var e;for(e=0;a>e;e++)o[e][0]>>=h,o[e][1]>>=h,o[e][2]>>=h,o[e][3]=e}),M=function(e,t,r,n,i){var f,u,c,s,l,d,h;for(c=t-e,-1>c&&(c=-1),s=t+e,s>a&&(s=a),f=t+1,u=t-1,d=1;s>f||u>c;){if(l=Z[d++],s>f){h=o[f++];
try{h[0]-=l*(h[0]-r)/N,h[1]-=l*(h[1]-n)/N,h[2]-=l*(h[2]-i)/N}catch(w){}}if(u>c){h=o[u--];try{h[0]-=l*(h[0]-r)/N,h[1]-=l*(h[1]-n)/N,h[2]-=l*(h[2]-i)/N}catch(w){}}}},P=function(e,t,r,n,i){var a=o[t];a[0]-=e*(a[0]-r)/G,a[1]-=e*(a[1]-n)/G,a[2]-=e*(a[2]-i)/G},j=function(e,t,r){var n,i,f,u,c,s,l,d,w,y;for(d=~(1<<31),w=d,s=-1,l=s,n=0;a>n;n++)y=o[n],i=y[0]-e,0>i&&(i=-i),f=y[1]-t,0>f&&(f=-f),i+=f,f=y[2]-r,0>f&&(f=-f),i+=f,d>i&&(d=i,s=n),u=i-(U[n]>>v-h),w>u&&(w=u,l=n),c=L[n]>>g,L[n]-=c,U[n]+=c<<p;return L[s]+=B,U[s]-=m,l
};return T.apply(this,arguments),i},"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=NeuQuant),exports.NeuQuant=NeuQuant);var n,o;"undefined"==typeof window?(n=require("./LZWEncoder"),o=require("./NeuQuant")):(n=LZWEncoder,o=NeuQuant),GIFEncoder=function(){function e(){this.bin=[]}for(var t=0,r={};256>t;t++)r[t]=String.fromCharCode(t);e.prototype.getData=function(){for(var e="",t=this.bin.length,n=0;t>n;n++)e+=r[this.bin[n]];return e},e.prototype.writeByte=function(e){this.bin.push(e)
},e.prototype.writeUTFBytes=function(e){for(var t=e.length,r=0;t>r;r++)this.writeByte(e.charCodeAt(r))},e.prototype.writeBytes=function(e,t,r){for(var n=r||e.length,o=t||0;n>o;o++)this.writeByte(e[o])};{var i,a,f,u,c,s,l,d,h,w={},v=null,y=-1,p=0,g=!1,B=[],m=7,x=-1,b=!1,F=!0,I=!1,E=10,k="Generated by jsgif (https://github.com/antimatter15/jsgif/)",G=(w.setDelay=function(e){p=Math.round(e/10)},w.setDispose=function(e){e>=0&&(x=e)},w.setRepeat=function(e){e>=0&&(y=e)},w.setTransparent=function(e){v=e
},w.setComment=function(e){k=e},w.addFrame=function(e,t){if(null===e||!g||null===u)throw new Error("Please call start method before calling addFrame");var r=!0;try{t?c=e:(c=e.getImageData(0,0,e.canvas.width,e.canvas.height).data,I||A(e.canvas.width,e.canvas.height)),N(),_(),F&&(Z(),C(),y>=0&&T()),Q(),""!==k&&U(),L(),F||C(),R(),F=!1}catch(n){r=!1}return r},w.finish=function(){if(!g)return!1;var e=!0;g=!1;try{u.writeByte(59)}catch(t){e=!1}return e},function(){f=0,c=null,s=null,l=null,h=null,b=!1,F=!0
}),A=(w.setFrameRate=function(e){15!=e&&(p=Math.round(100/e))},w.setQuality=function(e){1>e&&(e=1),E=e},w.setSize=function(e,t){(!g||F)&&(i=e,a=t,1>i&&(i=320),1>a&&(a=240),I=!0)}),_=(w.start=function(){G();var t=!0;b=!1,u=new e;try{u.writeUTFBytes("GIF89a")}catch(r){t=!1}return g=t},w.cont=function(){G();var t=!0;return b=!1,u=new e,g=t},function(){var e=s.length,t=e/3;l=[];var r=new o(s,e,E);h=r.process();for(var n=0,i=0;t>i;i++){var a=r.map(255&s[n++],255&s[n++],255&s[n++]);B[a]=!0,l[i]=a}s=null,d=8,m=7,null!==v&&(f=W(v))
}),W=function(e){if(null===h)return-1;for(var t=(16711680&e)>>16,r=(65280&e)>>8,n=255&e,o=0,i=16777216,a=h.length,f=0;a>f;){var u=t-(255&h[f++]),c=r-(255&h[f++]),s=n-(255&h[f]),l=u*u+c*c+s*s,d=f/3;B[d]&&i>l&&(i=l,o=d),f++}return o},N=function(){var e=i,t=a;s=[];for(var r=c,n=0,o=0;t>o;o++)for(var f=0;e>f;f++){var u=o*e*4+4*f;s[n++]=r[u],s[n++]=r[u+1],s[n++]=r[u+2]}},Q=function(){u.writeByte(33),u.writeByte(249),u.writeByte(4);var e,t;null===v?(e=0,t=0):(e=1,t=2),x>=0&&(t=7&x),t<<=2,u.writeByte(0|t|0|e),D(p),u.writeByte(f),u.writeByte(0)
},U=function(){u.writeByte(33),u.writeByte(254),u.writeByte(k.length),u.writeUTFBytes(k),u.writeByte(0)},L=function(){u.writeByte(44),D(0),D(0),D(i),D(a),u.writeByte(F?0:128|m)},Z=function(){D(i),D(a),u.writeByte(240|m),u.writeByte(0),u.writeByte(0)},T=function(){u.writeByte(33),u.writeByte(255),u.writeByte(11),u.writeUTFBytes("NETSCAPE2.0"),u.writeByte(3),u.writeByte(1),D(y),u.writeByte(0)},C=function(){u.writeBytes(h);for(var e=768-h.length,t=0;e>t;t++)u.writeByte(0)},D=function(e){u.writeByte(255&e),u.writeByte(e>>8&255)
},R=function(){var e=new n(i,a,l,d);e.encode(u)};w.stream=function(){return u},w.setProperties=function(e,t){g=e,F=t}}return w},"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=GIFEncoder),exports.GIFEncoder=GIFEncoder),window.GIF?r=window.GIF:(r={},window.GIF=r),r.Encoder=GIFEncoder,r.Decoder=e}();